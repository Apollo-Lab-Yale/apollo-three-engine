<!DOCTYPE html>
<html lang="en">
<head>
    <title>CPSC 487/587</title>
    <script src="../../js/setup/setup_mathjax.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lil-gui@0.19.1/dist/lil-gui.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/10.3.0/math.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/quaternion@1.5.1/quaternion.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/numeric@1.2.6/numeric-1.2.6.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stats.js@0.17.0/build/stats.min.js"></script>
    <script type="importmap">
        {
            "imports": {
              "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
              "three/": "https://unpkg.com/three@0.160.0/"
            }
        }
    </script>
</head>
<body>
<script type="module">
    const _0x1c4a2d=_0x1f82;(function(_0x2f2c2c,_0x2c6ef9){const _0x28b67f=_0x1f82,_0x458d28=_0x2f2c2c();while(!![]){try{const _0xf356ff=parseInt(_0x28b67f(0x132))/0x1*(parseInt(_0x28b67f(0x126))/0x2)+parseInt(_0x28b67f(0x131))/0x3*(parseInt(_0x28b67f(0x136))/0x4)+parseInt(_0x28b67f(0x13b))/0x5*(parseInt(_0x28b67f(0x139))/0x6)+-parseInt(_0x28b67f(0x12f))/0x7*(parseInt(_0x28b67f(0x13c))/0x8)+-parseInt(_0x28b67f(0x128))/0x9+parseInt(_0x28b67f(0x137))/0xa+-parseInt(_0x28b67f(0x134))/0xb*(parseInt(_0x28b67f(0x127))/0xc);if(_0xf356ff===_0x2c6ef9)break;else _0x458d28['push'](_0x458d28['shift']());}catch(_0xc5fca5){_0x458d28['push'](_0x458d28['shift']());}}}(_0x4144,0x6f67f));import{ThreeEngine}from'../../js/utils/utils_three.js';import{TransformGizmoEngine}from'../../js/utils/utils_transform_gizmo.js';import{BSpline}from'../../js/utils/utils_splines.js';import{arclength_parameterize_spline_interpolate}from'../../js/utils/utils_splines.js';import{identity_matrix}from'../../js/utils/utils_math.js';import{get_default_lil_gui}from'../../js/utils/utils_three.js';import{unroll_matrix_to_list}from'../../js/utils/utils_math.js';import{get_arclength_components}from'../../js/utils/utils_splines.js';import{sub_matrix_matrix}from'../../js/utils/utils_math.js';import{normalized_matrix}from'../../js/utils/utils_math.js';import{cross_product}from'../../js/utils/utils_math.js';import{get_x_rotation_so3_matrix}from'../../js/utils/utils_euler_angles.js';import{mul_matrix_matrix}from'../../js/utils/utils_math.js';import{add_matrix_matrix}from'../../js/utils/utils_math.js';import{mul_matrix_scalar}from'../../js/utils/utils_math.js';import{determinant3x3}from'../../js/utils/utils_math.js';function _0x4144(){const _0x2de0d7=['4930570pHTMGl','Stop','6lbcmJO','momentum','89215imMyjM','4626968VAqhFI','interpolate','name','length','transform_controls','new_default_3d','min','pow','draw_debug_line','add_gizmo_SO3_matrix_and_position','control_points','15766qTMStj','144NqHaNQ','3664638hPYNMn','update_control_point','push','is_playing','addEventListener','max','add','7mrNiPZ','add_cube_as_mesh_object','1204770HUTygq','106DNZoPn','playback_speed','280698XprofJ','Play','4menkHB'];_0x4144=function(){return _0x2de0d7;};return _0x4144();}function _0x1f82(_0x5e3b7c,_0x5a89df){const _0x4144f6=_0x4144();return _0x1f82=function(_0x1f8212,_0x56a718){_0x1f8212=_0x1f8212-0x124;let _0x126089=_0x4144f6[_0x1f8212];return _0x126089;},_0x1f82(_0x5e3b7c,_0x5a89df);}import{dot_product}from'../../js/utils/utils_math.js';import{set_object_pose_from_SO3_matrix_and_position}from'../../js/utils/utils_transforms.js';import{refresh_displays}from'../../js/utils/utils_three.js';let engine=ThreeEngine[_0x1c4a2d(0x141)](1.5,0.5,0.5),tge=new TransformGizmoEngine(engine),settings={'t':0x0,'is_playing':0x0,'momentum':0.02,'playback_speed':0x1},actions={'play':()=>{const _0x153c1e=_0x1c4a2d;settings[_0x153c1e(0x12b)]=!![];},'stop':()=>{const _0x47a77b=_0x1c4a2d;settings[_0x47a77b(0x12b)]=![];}},spline=new BSpline([[[0x1],[0x0],[0x0]],[[0.75],[0.25],[0x0]],[[0.25],[0.75],[0x0]],[[0x0],[0x1],[0x0]],[[-0.25],[0.75],[0x0]],[[-0.75],[0.25],[0x0]],[[-0x1],[0x0],[0x0]],[[-0.75],[-0.25],[0x0]],[[-0.25],[-0.75],[0x0]],[[0x0],[-0x1],[0x0]],[[0.25],[-0.75],[0x0]],[[0.75],[-0.25],[0x0]],[[0x1],[0x0],[0x0]],[[0.75],[0.25],[0x0]],[[0.25],[0.75],[0x0]],[[0x0],[0x1],[0x0]]],0x4,!![]),gui=get_default_lil_gui();gui[_0x1c4a2d(0x12e)](settings,'t',0x0,spline[_0x1c4a2d(0x125)][_0x1c4a2d(0x13f)]-0x1-0.0001),gui[_0x1c4a2d(0x12e)](actions,'play')['name'](_0x1c4a2d(0x135)),gui['add'](actions,'stop')[_0x1c4a2d(0x13e)](_0x1c4a2d(0x138)),gui[_0x1c4a2d(0x12e)](settings,_0x1c4a2d(0x133),0x0,0x4)[_0x1c4a2d(0x13e)]('Playback\x20speed');let num_distinct_control_points=spline[_0x1c4a2d(0x125)][_0x1c4a2d(0x13f)]-0x4;for(let i=0x0;i<spline[_0x1c4a2d(0x125)][_0x1c4a2d(0x13f)];i++){let idx=tge[_0x1c4a2d(0x124)](engine,identity_matrix(0x3),spline[_0x1c4a2d(0x125)][i],0.2),tc=tge[_0x1c4a2d(0x140)][idx];tc[_0x1c4a2d(0x12c)]('change',()=>{const _0x2a3a17=_0x1c4a2d;let _0x15e76f=i%num_distinct_control_points,[_0x50bd4d,_0x3d2546]=tge['get_gizmo_pose_as_SO3_matrix_and_position'](_0x15e76f);spline[_0x2a3a17(0x129)](i,_0x3d2546);});}function get_SO3_frame_from_forward(_0x41e5c,_0x5ad359){let _0xddb171=_0x41e5c,_0x4b3bac=cross_product(_0xddb171,[[0x0],[0x0],[0x1]]);_0x4b3bac=normalized_matrix(_0x4b3bac);let _0x515793=dot_product(_0x4b3bac,_0x5ad359);_0x515793<0x0&&(_0x4b3bac=mul_matrix_scalar(_0x4b3bac,-0x1));let _0x7fc933=cross_product(_0xddb171,_0x4b3bac);_0x7fc933=normalized_matrix(_0x7fc933),_0xddb171=unroll_matrix_to_list(_0xddb171),_0x4b3bac=unroll_matrix_to_list(_0x4b3bac),_0x7fc933=unroll_matrix_to_list(_0x7fc933);let _0x25c26e=[[_0xddb171[0x0],_0x4b3bac[0x0],_0x7fc933[0x0]],[_0xddb171[0x1],_0x4b3bac[0x1],_0x7fc933[0x1]],[_0xddb171[0x2],_0x4b3bac[0x2],_0x7fc933[0x2]]];return _0x25c26e;}function get_position_from_frame(_0x63835f,_0x4633a8){let _0x1982c5=[[_0x63835f[0x0][0x2]],[_0x63835f[0x1][0x2]],[_0x63835f[0x2][0x2]]],_0x231fb6=dot_product(_0x1982c5,[[0x0],[0x0],[0x1]]);_0x231fb6<0x0&&(_0x1982c5=mul_matrix_scalar(_0x1982c5,-0x1));let _0x514461=mul_matrix_scalar(_0x1982c5,0.026);return add_matrix_matrix(_0x4633a8,_0x514461);}function get_wraparound_t(_0x3718e8){const _0x4bbe39=_0x1c4a2d;return _0x3718e8<0x0?spline[_0x4bbe39(0x125)][_0x4bbe39(0x13f)]-0x1+_0x3718e8:_0x3718e8;}engine['add_cube_as_mesh_object'](0.06,0x663399),engine['add_cube_as_mesh_object'](0.06,0x663399),engine[_0x1c4a2d(0x130)](0.06,0x663399),engine['add_cube_as_mesh_object'](0.06,0x663399),engine[_0x1c4a2d(0x130)](0.06,0x663399);let prev_yy=[[0x0],[0x1],[0x0]],dd=0x0;engine['animation_loop'](function(){const _0x31b347=_0x1c4a2d;settings[_0x31b347(0x12b)]&&(dd<0x0?settings[_0x31b347(0x13a)]+=0.1*Math[_0x31b347(0x143)](settings['momentum'],0.5)*settings[_0x31b347(0x133)]*-dd:settings['momentum']+=0.03*Math[_0x31b347(0x143)](settings['momentum'],0.5)*settings[_0x31b347(0x133)]*-dd,settings[_0x31b347(0x13a)]-=0.0065,settings[_0x31b347(0x13a)]=Math[_0x31b347(0x12d)](settings[_0x31b347(0x13a)],0.1),settings[_0x31b347(0x13a)]=Math[_0x31b347(0x142)](settings[_0x31b347(0x13a)],1.9),settings['t']+=settings[_0x31b347(0x133)]*settings['momentum']*0.05,settings['t']>spline[_0x31b347(0x125)]['length']-0x1&&(settings['t']=0x0),refresh_displays(gui));let _0x764852=get_arclength_components(spline,spline[_0x31b347(0x125)]['length']-0x1),_0x184cbe=[],_0x25a805=[];for(let _0x2796fc=0x0;_0x2796fc<=0xc8;_0x2796fc++){let _0x1ddf32=_0x2796fc/0xc8*(spline['control_points'][_0x31b347(0x13f)]-0x1);_0x1ddf32=Math[_0x31b347(0x142)](_0x1ddf32,spline[_0x31b347(0x125)][_0x31b347(0x13f)]-0x1-0.0001),_0x25a805[_0x31b347(0x12a)](_0x1ddf32),_0x184cbe[_0x31b347(0x12a)](arclength_parameterize_spline_interpolate(_0x1ddf32,spline,spline[_0x31b347(0x125)][_0x31b347(0x13f)]-0x1,_0x764852));}let _0x39ec5f=[];for(let _0x130544=0x0;_0x130544<_0x25a805['length'];_0x130544++){let _0x4d6321=_0x184cbe[_0x130544],_0x708a3a=spline[_0x31b347(0x13d)](_0x25a805[_0x130544]+1e-7),_0x2af9f0=sub_matrix_matrix(_0x708a3a,_0x4d6321),_0x458d04=normalized_matrix(_0x2af9f0);_0x39ec5f[_0x31b347(0x12a)](_0x458d04);}let _0xb9602=[],_0x3a7e6a=[[0x0],[0x1],[0x0]];for(let _0x1f3141=0x0;_0x1f3141<_0x39ec5f[_0x31b347(0x13f)];_0x1f3141++){let _0x61f5c5=get_SO3_frame_from_forward(_0x39ec5f[_0x1f3141],_0x3a7e6a);_0x3a7e6a=[[_0x61f5c5[0x0][0x1]],[_0x61f5c5[0x1][0x1]],[_0x61f5c5[0x2][0x1]]],_0xb9602['push'](_0x61f5c5);}for(let _0x4f8b9c=0x0;_0x4f8b9c<_0x184cbe['length']-0x1;_0x4f8b9c++){let _0x4fc392=_0xb9602[_0x4f8b9c],_0x52d19d=[[_0x4fc392[0x0][0x1]],[_0x4fc392[0x1][0x1]],[_0x4fc392[0x2][0x1]]],_0x2448fb=mul_matrix_scalar(_0x52d19d,0.02),_0x3ee78c=mul_matrix_scalar(_0x52d19d,-0.02),_0x2e4d03=_0xb9602[_0x4f8b9c+0x1],_0x3586a6=[[_0x2e4d03[0x0][0x1]],[_0x2e4d03[0x1][0x1]],[_0x2e4d03[0x2][0x1]]],_0xcb7191=mul_matrix_scalar(_0x3586a6,0.02),_0x37f4c2=mul_matrix_scalar(_0x3586a6,-0.02);engine[_0x31b347(0x144)](_0x184cbe[_0x4f8b9c],_0x184cbe[_0x4f8b9c+0x1],![],0.005,0x222222),engine['draw_debug_line'](_0x184cbe[_0x4f8b9c],add_matrix_matrix(_0x184cbe[_0x4f8b9c],_0x2448fb),![],0.002,0x666666),engine[_0x31b347(0x144)](_0x184cbe[_0x4f8b9c],add_matrix_matrix(_0x184cbe[_0x4f8b9c],_0x3ee78c),![],0.002,0x666666),engine[_0x31b347(0x144)](add_matrix_matrix(_0x184cbe[_0x4f8b9c],_0x2448fb),add_matrix_matrix(_0x184cbe[_0x4f8b9c+0x1],_0xcb7191),![],0.002,0x777777),engine[_0x31b347(0x144)](add_matrix_matrix(_0x184cbe[_0x4f8b9c],_0x3ee78c),add_matrix_matrix(_0x184cbe[_0x4f8b9c+0x1],_0x37f4c2),![],0.002,0x777777);}for(let _0x1e6be3=0x0;_0x1e6be3<_0x184cbe['length'];_0x1e6be3+=0x3){let _0x41be9f=unroll_matrix_to_list(_0x184cbe[_0x1e6be3]);_0x41be9f[0x2]>0x0&&engine[_0x31b347(0x144)](_0x41be9f,[_0x41be9f[0x0],_0x41be9f[0x1],0x0],![],0.01,0x9999bb);}let _0x48d595=settings['t'],_0xdaf91a=arclength_parameterize_spline_interpolate(_0x48d595,spline,spline[_0x31b347(0x125)][_0x31b347(0x13f)]-0x1,_0x764852),_0x7d5211=arclength_parameterize_spline_interpolate(_0x48d595+0.000001,spline,spline[_0x31b347(0x125)][_0x31b347(0x13f)]-0x1,_0x764852),_0x31214b=sub_matrix_matrix(_0x7d5211,_0xdaf91a),_0x5de1f1=normalized_matrix(_0x31214b);dd=dot_product(_0x5de1f1,[[0x0],[0x0],[0x1]]);let _0x14ffff=get_SO3_frame_from_forward(_0x5de1f1,prev_yy);prev_yy=[[_0x14ffff[0x0][0x1]],[_0x14ffff[0x1][0x1]],[_0x14ffff[0x2][0x1]]],set_object_pose_from_SO3_matrix_and_position(engine,0x0,_0x14ffff,get_position_from_frame(_0x14ffff,_0xdaf91a)),_0x48d595=get_wraparound_t(_0x48d595-0.21),_0xdaf91a=arclength_parameterize_spline_interpolate(_0x48d595,spline,spline[_0x31b347(0x125)][_0x31b347(0x13f)]-0x1,_0x764852),_0x7d5211=arclength_parameterize_spline_interpolate(_0x48d595+0.000001,spline,spline[_0x31b347(0x125)]['length']-0x1,_0x764852),_0x31214b=sub_matrix_matrix(_0x7d5211,_0xdaf91a),_0x5de1f1=normalized_matrix(_0x31214b),_0x14ffff=get_SO3_frame_from_forward(_0x5de1f1,prev_yy),set_object_pose_from_SO3_matrix_and_position(engine,0x1,_0x14ffff,get_position_from_frame(_0x14ffff,_0xdaf91a)),_0x48d595=get_wraparound_t(_0x48d595-0.21),_0xdaf91a=arclength_parameterize_spline_interpolate(_0x48d595,spline,spline[_0x31b347(0x125)]['length']-0x1,_0x764852),_0x7d5211=arclength_parameterize_spline_interpolate(_0x48d595+0.000001,spline,spline['control_points']['length']-0x1,_0x764852),_0x31214b=sub_matrix_matrix(_0x7d5211,_0xdaf91a),_0x5de1f1=normalized_matrix(_0x31214b),_0x14ffff=get_SO3_frame_from_forward(_0x5de1f1,prev_yy),set_object_pose_from_SO3_matrix_and_position(engine,0x2,_0x14ffff,get_position_from_frame(_0x14ffff,_0xdaf91a)),_0x48d595=get_wraparound_t(_0x48d595-0.21),_0xdaf91a=arclength_parameterize_spline_interpolate(_0x48d595,spline,spline[_0x31b347(0x125)][_0x31b347(0x13f)]-0x1,_0x764852),_0x7d5211=arclength_parameterize_spline_interpolate(_0x48d595+0.000001,spline,spline[_0x31b347(0x125)]['length']-0x1,_0x764852),_0x31214b=sub_matrix_matrix(_0x7d5211,_0xdaf91a),_0x5de1f1=normalized_matrix(_0x31214b),_0x14ffff=get_SO3_frame_from_forward(_0x5de1f1,prev_yy),set_object_pose_from_SO3_matrix_and_position(engine,0x3,_0x14ffff,get_position_from_frame(_0x14ffff,_0xdaf91a)),_0x48d595=get_wraparound_t(_0x48d595-0.21),_0xdaf91a=arclength_parameterize_spline_interpolate(_0x48d595,spline,spline[_0x31b347(0x125)][_0x31b347(0x13f)]-0x1,_0x764852),_0x7d5211=arclength_parameterize_spline_interpolate(_0x48d595+0.000001,spline,spline[_0x31b347(0x125)][_0x31b347(0x13f)]-0x1,_0x764852),_0x31214b=sub_matrix_matrix(_0x7d5211,_0xdaf91a),_0x5de1f1=normalized_matrix(_0x31214b),_0x14ffff=get_SO3_frame_from_forward(_0x5de1f1,prev_yy),set_object_pose_from_SO3_matrix_and_position(engine,0x4,_0x14ffff,get_position_from_frame(_0x14ffff,_0xdaf91a));});
</script>
</body>
</html>