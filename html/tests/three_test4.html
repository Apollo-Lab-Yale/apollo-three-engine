<!DOCTYPE html>
<html>
    <head>
        <title>CPSC 487/587</title>
        <script src="../../js/setup/setup_mathjax.js"></script>
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
        <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/lil-gui@0.19.1/dist/lil-gui.umd.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/10.3.0/math.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/quaternion@1.5.1/quaternion.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/numeric@1.2.6/numeric-1.2.6.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/stats.js@0.17.0/build/stats.min.js"></script>
        <script type="importmap">
            {
                "imports": {
                  "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                  "three/": "https://unpkg.com/three@0.160.0/"
                }
            }
        </script>
    </head>
    <body>
        <script type="module">
            import { ThreeEngine } from "../../js/utils/utils_three.js";
            import {spawn_cone_base} from "../../js/utils/utils_three.js";
            import {convert_z_up_array_to_y_up_array} from "../../js/utils/utils_three.js";
            import {z_up_set_object_rotation_from_xyz_euler_angles} from "../../js/utils/utils_three.js";
            import {convert_threejs_vector3_to_array} from "../../js/utils/utils_three.js";
            import {convert_array_to_threejs_vector3} from "../../js/utils/utils_three.js";
            import {load_obj_from_string, suzanne_monkey_obj_string} from "../../js/utils/utils_three.js";
            import {get_default_lil_gui} from "../../js/utils/utils_three.js";

            const engine = ThreeEngine.new_default_3d();
            // await engine.add_gltf_mesh_object('../meshes/suzanne.gltf');
            // await engine.add_stl_mesh_object('../meshes/suzanne_lowres.stl');
            // engine.add_torus_as_mesh_object();
            engine.add_suzanne_monkey_as_mesh_object(0x00eeff);

            // let gui = get_default_lil_gui();

            // engine.add_gizmo_controller([5,1,1], [1,0,0,0]);
            // engine.remove_gizmo_controller(0);
            // engine.add_gizmo_controller([2,1,1], [1,0,0,0]);
            // engine.add_gizmo_controller([2,1,-1], [1,0,0,0]);

            // var transformControls = new THREE.TransformControls(engine.camera, engine.renderer.domElement);
            // engine.scene.add(transformControls);

            // engine.gizmo_controllers[0].addEventListener('dragging-changed', function (event) {
            //     engine.controls.enabled = !event.value;
            // });

            // transformControls.setMode("rotate");

            // let mesh = engine.mesh_objects[0];
            // transformControls.attach(mesh);

            // load_obj_from_string(engine.scene, suzanne_monkey_obj_string());

            // console.log(engine.mesh_objects[0]);
            // let geometry = engine.mesh_objects[0].geometry;
            // let position = geometry.attributes.position.array[0];
            // console.log(position);
            // position = -1.0;
            // console.log(position);

            // let mesh = engine.mesh_objects[0];
            // const positionAttribute = mesh.geometry.attributes.position;
            // positionAttribute.array[6] += 2; // x
            // positionAttribute.array[7] += 0; // y
            // positionAttribute.array[8] += 0; // z
            // positionAttribute.needsUpdate = true;
            // mesh.geometry.vertices[0].x += 1;
            // mesh.geometry.verticesNeedUpdate = true;

            // engine.toggle_mesh_object_wireframe_visibility(0);
            // let positions = engine.mesh_objects_local_vertex_positions[0];
            // console.log(positions);

            // let tube = spawn_line(engine.scene, convert_z_up_array_to_y_up_array([0,0,0]), convert_z_up_array_to_y_up_array([0,-1,0]), undefined, 1);
            // let a = convert_z_up_array_to_y_up_array([1,1,0]);
            // tube.scale.set(0.03,0.03,1);
            // z_up_set_object_position(tube,-2,0,0);
            // tube.lookAt(a[0], a[1], a[2]);

            // let cone = spawn_cone(engine.scene, 1, 1, 10, 1);
            // let a = convert_z_up_array_to_y_up_array([-1,0,0]);
            // cone.lookAt(a[0], a[1], a[2]);
            // let quaternion = new THREE.Quaternion();
            // quaternion.setFromEuler(new THREE.Euler(1.57, 0., 0.));
            // cone.quaternion.multiply(quaternion);

            // let num_vertices = engine.num_vertices_in_mesh_object(0);
            // let vertices = engine.get_local_vertex_positions_of_mesh_object(0);

            engine.animation_loop(function() {
                // console.log(num_vertices);
                // YOUR CODE GOES HERE /////

                // engine.draw_debug_sphere([Math.sin(engine.frame_idx * 0.01),0.,1.], 0.1);

                // engine.draw_debug_sphere([0,-2,0], 0.1);

                // engine.draw_debug_line([Math.sin(engine.frame_idx*0.1),-1,0], [1,0,1], true, 0.03);

                // engine.draw_debug_sphere([1,1,2], 0.1);
                // engine.draw_debug_vector([1,0,0], [1,1,0], 0.02);
                // engine.draw_debug_vector([0,0,0], [1,1,1], 0.02);

                // let new_vertices = vertices.map(vertex =>

                // [vertex[0] + 2.0, vertex[1] + 1.0, vertex[2] + 1.0]

                // );

                // engine.update_vertex_positions_of_mesh_object(0, new_vertices);

                // console.log(engine.get_position_of_gizmo_controller(0));
                // for(let i=0; i < num_vertices; i++) {
                //     let curr_vertex = vertices[i];
                //     let curr_vertex_as_three = convert_array_to_threejs_vector3(curr_vertex);
                //     curr_vertex_as_three = curr_vertex_as_three.add(new THREE.Vector3(1.,0.,0.));
                //     console.log(curr_vertex_as_three);
                //     engine.update_vertex_position_in_mesh_object(0, i, convert_threejs_vector3_to_array(curr_vertex_as_three));
                // }

                // engine.update_vertex_position_in_mesh_object(0, 0, [3.,4.,5.]);
                // engine.update_vertex_position_in_mesh_object(0, 1, [3.,4.,5.]);
                // engine.update_vertex_position_in_mesh_object(0, 2, [3.,4.,5.]);
                // engine.get_local_vertex_positions_of_mesh_object(0).forEach( vertex => {
                //     engine.draw_debug_sphere(vertex, 0.025, 0x00ee00);
                // });

                // engine.draw_debug_cone([0.,0.,0.], [1.0,0.,1.0], 0.3, 1.0, 10);

                // console.log(engine.mesh_objects[0]);

            ///////////////////////////
            });
        </script>
    </body>
</html>